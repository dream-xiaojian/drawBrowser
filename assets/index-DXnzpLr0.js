var xt=Object.defineProperty;var mt=(e,t,s)=>t in e?xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var g=(e,t,s)=>(mt(e,typeof t!="symbol"?t+"":t,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function s(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(i){if(i.ep)return;i.ep=!0;const l=s(i);fetch(i.href,l)}})();function vt(e){return e.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}function bt(e,t){let s=t.getBoundingClientRect(),r=e.clientX-s.left,i=e.clientY-s.top;return{x:r,y:i}}function N(...e){return e.reduce((s,r)=>s+r,0)/e.length}class _{constructor(t,s){g(this,"el",null);g(this,"pointEvent",null);this.strategyStyle=t,this.keys=s}isKeyPass(t){return this.keys[t]||!1}setStyle(t){for(let s in this.strategyStyle)if(this.strategyStyle.hasOwnProperty(s)){let r=s;t.setAttribute(vt(s),String(this.strategyStyle[r]))}}createElement(t){const s=document.createElementNS("http://www.w3.org/2000/svg",t);return this.setStyle(s),s}onStart(t){return null}onProcess(t){return null}onEnd(t){return null}initMouseCoordinates(t,s){return this.pointEvent=t,bt(t,s)}_eventStart(t,s){let r=this.initMouseCoordinates(t,s);return this.onStart(r)}_eventProcess(t,s){let r=this.initMouseCoordinates(t,s);return this.onProcess(r)}_eventEnd(t,s){let r=this.initMouseCoordinates(t,s);return this.onEnd(r)}static getSvgPathFromStroke(t){const s=t.length;if(s<4)return"";let r=t[0],i=t[1];const l=t[2];let u=`M${r[0].toFixed(2)},${r[1].toFixed(2)} Q${i[0].toFixed(2)},${i[1].toFixed(2)} ${N(i[0],l[0]).toFixed(2)},${N(i[1],l[1]).toFixed(2)} T`;for(let n=2,a=s-1;n<a;n++)r=t[n],i=t[n+1],u+=`${N(r[0],i[0]).toFixed(2)},${N(r[1],i[1]).toFixed(2)} `;return u+="Z",u}}class Pt extends _{onStart(t){return this.el=this.createElement("line"),this.el.setAttribute("x1",t.x.toString()),this.el.setAttribute("y1",t.y.toString()),this.el.setAttribute("x2",t.x.toString()),this.el.setAttribute("y2",t.y.toString()),this.el}onProcess(t){if(this.el==null)return!1;if(this.isKeyPass("Shift")){const s=t.x-parseInt(this.el.getAttribute("x1")),r=t.y-parseInt(this.el.getAttribute("y1"));let i=Math.atan2(r,s)*180/Math.PI;i=Math.round(i/45)*45;const l=Math.sqrt(s*s+r*r);t.x=parseInt(this.el.getAttribute("x1"))+l*Math.cos(i*Math.PI/180),t.y=parseInt(this.el.getAttribute("y1"))+l*Math.sin(i*Math.PI/180)}return this.el.setAttribute("x2",t.x.toString()),this.el.setAttribute("y2",t.y.toString()),!0}onEnd(t){return this.el=null,!0}}function Et(e,t){return new Pt(e,t)}class wt extends _{constructor(){super(...arguments);g(this,"startPoint",null)}onStart(s){return this.el=this.createElement("ellipse"),this.startPoint=s,this.el}onProcess(s){return this.el==null||this.startPoint==null?!1:(this.calculate(s),!0)}onEnd(s){return this.el=null,!0}calculate(s){let r=this.startPoint.x,i=this.startPoint.y,l=s.x,u=s.y,n=Math.abs(l-r)/2,a=Math.abs(u-i)/2;if(this.isKeyPass("Shift")){let x=Math.min(n,a);n=x,a=x}let b=r+n,E=i+a;l<r&&(b=r-n),u<i&&(E=i-a),this.el.setAttribute("cx",b.toString()),this.el.setAttribute("cy",E.toString()),this.el.setAttribute("rx",n.toString()),this.el.setAttribute("ry",a.toString())}}function At(e,t){return new wt(e,t)}function nt(e,t,s,r=i=>i){return e*r(.5-t*(.5-s))}function Mt(e){return[-e[0],-e[1]]}function v(e,t){return[e[0]+t[0],e[1]+t[1]]}function S(e,t){return[e[0]-t[0],e[1]-t[1]]}function m(e,t){return[e[0]*t,e[1]*t]}function Lt(e,t){return[e[0]/t,e[1]/t]}function $(e){return[e[1],-e[0]]}function lt(e,t){return e[0]*t[0]+e[1]*t[1]}function kt(e,t){return e[0]===t[0]&&e[1]===t[1]}function _t(e){return Math.hypot(e[0],e[1])}function Bt(e){return e[0]*e[0]+e[1]*e[1]}function ot(e,t){return Bt(S(e,t))}function dt(e){return Lt(e,_t(e))}function Ft(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function O(e,t,s){let r=Math.sin(s),i=Math.cos(s),l=e[0]-t[0],u=e[1]-t[1],n=l*i-u*r,a=l*r+u*i;return[n+t[0],a+t[1]]}function J(e,t,s){return v(e,m(S(t,e),s))}function at(e,t,s){return v(e,m(t,s))}var{min:F,PI:Tt}=Math,ht=.275,I=Tt+1e-4;function Ct(e,t={}){let{size:s=16,smoothing:r=.5,thinning:i=.5,simulatePressure:l=!0,easing:u=o=>o,start:n={},end:a={},last:b=!1}=t,{cap:E=!0,easing:x=o=>o*(2-o)}=n,{cap:H=!0,easing:f=o=>--o*o*o+1}=a;if(e.length===0||s<=0)return[];let y=e[e.length-1].runningLength,P=n.taper===!1?0:n.taper===!0?Math.max(s,y):n.taper,T=a.taper===!1?0:a.taper===!0?Math.max(s,y):a.taper,et=Math.pow(s*r,2),C=[],B=[],q=e.slice(0,10).reduce((o,d)=>{let h=d.pressure;if(l){let c=F(1,d.distance/s),Z=F(1,1-c);h=F(1,o+(Z-o)*(c*ht))}return(o+h)/2},e[0].pressure),p=nt(s,i,e[e.length-1].pressure,u),j,R=e[0].vector,D=e[0].point,X=D,L=D,k=X,U=!1;for(let o=0;o<e.length;o++){let{pressure:d}=e[o],{point:h,vector:c,distance:Z,runningLength:K}=e[o];if(o<e.length-1&&y-K<3)continue;if(i){if(l){let M=F(1,Z/s),Q=F(1,1-M);d=F(1,q+(Q-q)*(M*ht))}p=nt(s,i,d,u)}else p=s/2;j===void 0&&(j=p);let ft=K<P?x(K/P):1,pt=y-K<T?f((y-K)/T):1;p=Math.max(.01,p*Math.min(ft,pt));let st=(o<e.length-1?e[o+1]:e[o]).vector,G=o<e.length-1?lt(c,st):1,St=lt(c,R)<0&&!U,rt=G!==null&&G<0;if(St||rt){let M=m($(R),p);for(let Q=1/13,z=0;z<=1;z+=Q)L=O(S(h,M),h,I*z),C.push(L),k=O(v(h,M),h,I*-z),B.push(k);D=L,X=k,rt&&(U=!0);continue}if(U=!1,o===e.length-1){let M=m($(c),p);C.push(S(h,M)),B.push(v(h,M));continue}let it=m($(J(st,c,G)),p);L=S(h,it),(o<=1||ot(D,L)>et)&&(C.push(L),D=L),k=v(h,it),(o<=1||ot(X,k)>et)&&(B.push(k),X=k),q=d,R=c}let w=e[0].point.slice(0,2),A=e.length>1?e[e.length-1].point.slice(0,2):v(e[0].point,[1,1]),W=[],Y=[];if(e.length===1){if(!(P||T)||b){let o=at(w,dt($(S(w,A))),-(j||p)),d=[];for(let h=1/13,c=h;c<=1;c+=h)d.push(O(o,w,I*2*c));return d}}else{if(!(P||T&&e.length===1))if(E)for(let d=1/13,h=d;h<=1;h+=d){let c=O(B[0],w,I*h);W.push(c)}else{let d=S(C[0],B[0]),h=m(d,.5),c=m(d,.51);W.push(S(w,h),S(w,c),v(w,c),v(w,h))}let o=$(Mt(e[e.length-1].vector));if(T||P&&e.length===1)Y.push(A);else if(H){let d=at(A,o,p);for(let h=1/29,c=h;c<1;c+=h)Y.push(O(d,A,I*3*c))}else Y.push(v(A,m(o,p)),v(A,m(o,p*.99)),S(A,m(o,p*.99)),S(A,m(o,p)))}return C.concat(Y,B.reverse(),W)}function Dt(e,t={}){var s;let{streamline:r=.5,size:i=16,last:l=!1}=t;if(e.length===0)return[];let u=.15+(1-r)*.85,n=Array.isArray(e[0])?e:e.map(({x:f,y,pressure:P=.5})=>[f,y,P]);if(n.length===2){let f=n[1];n=n.slice(0,-1);for(let y=1;y<5;y++)n.push(J(n[0],f,y/4))}n.length===1&&(n=[...n,[...v(n[0],[1,1]),...n[0].slice(2)]]);let a=[{point:[n[0][0],n[0][1]],pressure:n[0][2]>=0?n[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],b=!1,E=0,x=a[0],H=n.length-1;for(let f=1;f<n.length;f++){let y=l&&f===H?n[f].slice(0,2):J(x.point,n[f],u);if(kt(x.point,y))continue;let P=Ft(y,x.point);if(E+=P,f<H&&!b){if(E<i)continue;b=!0}x={point:y,pressure:n[f][2]>=0?n[f][2]:.5,vector:dt(S(x.point,y)),distance:P,runningLength:E},a.push(x)}return a[0].vector=((s=a[1])==null?void 0:s.vector)||[0,0],a}function Kt(e,t={}){return Ct(Dt(e,t),t)}class V extends _{constructor(){super(...arguments);g(this,"points",[])}onStart(s){return this.el=this.createElement("path"),this.points=[s],this.el}onProcess(s){return this.el==null?!1:(this.points.push(s),this.el.setAttribute("d",V.getSvgPathD(this.points,this.strategyStyle)),!0)}onEnd(s){return this.el==null?!1:(this.el=null,!0)}static getSvgPathD(s,r){const i=Kt(s,{size:r.strokeWidth,thinning:.9,simulatePressure:!1,start:{taper:5},end:{taper:5},...r.strokeOptions});return _.getSvgPathFromStroke(i)}}function $t(e,t){return new V(e,t)}class Ot extends _{constructor(){super(...arguments);g(this,"startPoint",null)}onStart(s){return this.el=this.createElement("rect"),this.startPoint=s,this.el.setAttribute("x",s.x.toString()),this.el.setAttribute("y",s.y.toString()),this.el}onProcess(s){if(this.el==null||this.startPoint==null)return!1;let r=this.startPoint.x,i=this.startPoint.y,l=s.x,u=s.y,n=Math.abs(l-r),a=Math.abs(u-i);if(this.isKeyPass("Shift")){let b=Math.min(n,a);n=b,a=b}return l<r&&(r=r-n),u<i&&(i=i-a),this.el.setAttribute("x",r.toString()),this.el.setAttribute("y",i.toString()),this.el.setAttribute("width",n.toString()),this.el.setAttribute("height",a.toString()),!0}onEnd(s){return this.el==null?!1:(this.el=null,!0)}}function It(e,t){return new Ot(e,t)}class Ht extends _{constructor(){super(...arguments);g(this,"startPoint",null);g(this,"textarea",null);g(this,"borderWidth",2);g(this,"rectBorder",null);g(this,"processFlag",!1)}setGlobalStyle(){this.textarea.classList.add("drawBrowser-textarea"),this.rectBorder.classList.add("drawBrowser-textarea-border")}createForeignObject(){const s=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),r=document.createElement("div");return this.rectBorder=document.createElement("div"),this.textarea=document.createElement("textarea"),s.style.position="relative",r.style.position="absolute",r.style.width="100%",r.style.height="100%",this.textarea.style.width="100%",this.textarea.style.height="100%",this.textarea.style.boxSizing="border-box",this.rectBorder.style.position="absolute",this.textarea.style.boxSizing="border-box",this.rectBorder.style.width="100%",this.rectBorder.style.height="100%",this.setGlobalStyle(),r.appendChild(this.rectBorder),r.appendChild(this.textarea),s.appendChild(r),s}onStart(s){return this.el=this.createForeignObject(),this.startPoint=s,this.processFlag=!0,this.el.setAttribute("x",s.x.toString()),this.el.setAttribute("y",s.y.toString()),this.el}onProcess(s){if(this.processFlag==!1)return!1;const r=s.x-this.el.getBoundingClientRect().left,i=s.y-this.el.getBoundingClientRect().top;return this.el.setAttribute("width",`${r+this.borderWidth}px`),this.el.setAttribute("height",`${i+this.borderWidth}px`),!0}onEnd(s){return this.processFlag==!1?!1:(this.textarea.focus(),this.textarea.style.height="auto",this.rectBorder.style.display="none",this.resetHeight=this.resetHeight.bind(this),this.textarea.addEventListener("input",this.resetHeight),this.processFlag=!1,!0)}resetHeight(){this.textarea.style.height="auto";let s=this.textarea.scrollHeight;console.log(this.textarea.scrollHeight),this.el.setAttribute("height",`${s}px`),this.textarea.style.height=`${s}px`}}function Xt(e,t){return new Ht(e,t)}class Yt extends _{constructor(s,r,i){super(s,r);g(this,"startPoint",null);g(this,"speed",.5);g(this,"totalX",0);g(this,"totalY",0);this.el=i}onStart(s){return null}onProcess(s){if(this.isKeyPass(" "))if(console.log("开始移动"),this.startPoint==null)this.startPoint=s;else{console.log("point",s);let r=s.x-this.startPoint.x,i=s.y-this.startPoint.y;this.totalX+=this.speed*r,this.totalY+=this.speed*i;let l=`translate(${this.totalX}, ${this.totalY})`;this.el.setAttribute("transform",l)}else console.log("结束移动"),this.startPoint=null;return null}onEnd(s){return!0}}function zt(e,t,s){return new Yt(e,t,s)}function Nt(e){return{line:Et(e.options.strategyStyle,e.keys),ellipse:At(e.options.strategyStyle,e.keys),brush:$t(e.options.strategyStyle,e.keys),rect:It(e.options.strategyStyle,e.keys),text:Xt(e.options.strategyStyle,e.keys),hand:zt(e.options.strategyStyle,e.keys,e.el)}}class qt{constructor(t={}){g(this,"el",null);g(this,"drawStrategies");g(this,"keys",{});this.options=t,t.el&&this.mounted(t.el),this.drawStrategies=Nt(this)}get strategyTag(){return this.options.strategyTag||"brush"}set strategyTag(t){this.options.strategyTag=t}mounted(t,s=window){if(this.el)return new Error("The board has been mounted");const r=document.querySelector(t);if(!r)return new Error("The element is not exist");if(r.tagName!=="svg")return new Error("The element must be a svg element");this.el=r,this.setListenMethod(s)}setListenMethod(t=window){const s=this.el;this.onStart=this.onStart.bind(this),this.onProcess=this.onProcess.bind(this),this.onEnd=this.onEnd.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),s.addEventListener("pointerdown",this.onStart,{passive:!1}),t.addEventListener("pointermove",this.onProcess,{passive:!1}),t.addEventListener("pointerup",this.onEnd,{passive:!1}),t.addEventListener("pointercancel",this.onEnd,{passive:!1}),t.addEventListener("keydown",this.handleKeyDown),t.addEventListener("keyup",this.handleKeyUp)}recallProcess(){let t=this.drawStrategies[this.strategyTag].pointEvent;t&&this.strategyTag!="hand"&&this.drawStrategies[this.strategyTag]._eventProcess(t,this.el)}handleKeyDown(t){this.keys[t.key]=!0,this.recallProcess()}handleKeyUp(t){this.keys[t.key]=!1,this.recallProcess()}onStart(t){const s=this.drawStrategies[this.strategyTag]._eventStart(t,this.el);s&&this.el.appendChild(s)}onProcess(t){t.preventDefault(),this.drawStrategies[this.strategyTag]._eventProcess(t,this.el)&&(t.preventDefault(),t.stopPropagation())}onEnd(t){t.preventDefault(),t.stopPropagation(),this.drawStrategies[this.strategyTag]._eventEnd(t,this.el)}}function jt(e){return new qt(e)}const tt=jt({el:"#my_svg",strategyStyle:{stroke:"#000",fill:"transparent",strokeWidth:4}});let ut=document.querySelectorAll("[data-strategy]");ut.forEach(e=>{e.addEventListener("click",function(t){yt(ut),e.classList.add("active"),tt.strategyTag=e.getAttribute("data-strategy")})});let ct=document.querySelectorAll("[data-color]");ct.forEach(e=>{e.addEventListener("click",function(t){yt(ct),e.classList.add("active"),tt.options.strategyStyle.stroke=e.getAttribute("data-color")})});let gt=document.getElementById("size");gt.addEventListener("change",function(e){tt.options.strategyStyle.strokeWidth=Number(gt.value)});function yt(e){e.forEach(t=>{t.classList.remove("active")})}
